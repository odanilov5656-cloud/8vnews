<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Создать статью — 8V News</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="background: #f4f4f4; font-family: sans-serif; margin: 0;">
    <header style="background: #222; color: white; padding: 15px;">
        <div class="container" style="max-width: 800px; margin: 0 auto; display: flex; justify-content: space-between;">
            <a href="index.html" style="color: white; text-decoration: none;">← На главную</a>
            <strong>Новая публикация</strong>
        </div>
    </header>

    <main style="max-width: 600px; margin: 40px auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
        <h2 style="margin-top: 0;">Что нового?</h2>
        
        <label>Заголовок:</label>
        <input type="text" id="post-title" style="width: 100%; padding: 12px; margin: 10px 0 20px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">

        <label>Категория:</label>
        <select id="post-category" style="width: 100%; padding: 12px; margin: 10px 0 20px 0; border: 1px solid #ddd; border-radius: 6px;">
            <option>Технологии</option>
            <option>Спорт</option>
            <option>Жизнь</option>
            <option>Игры</option>
        </select>

        <label>Текст статьи:</label>
        <textarea id="post-content" style="width: 100%; height: 200px; padding: 12px; margin: 10px 0 20px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; resize: vertical;"></textarea>

        <button onclick="publishPost()" id="publish-btn" style="width: 100%; background: #27ae60; color: white; border: none; padding: 15px; border-radius: 6px; font-size: 16px; font-weight: bold; cursor: pointer;">Опубликовать</button>
    </main>

    <script>
        async function publishPost() {
            const btn = document.getElementById('publish-btn');
            const author = localStorage.getItem('currentUser');
            const title = document.getElementById('post-title').value;
            const content = document.getElementById('post-content').value;

            if (!author) { alert("Войдите в аккаунт!"); return; }
            if (!title || !content) { alert("Заполните все поля!"); return; }

            btn.disabled = true;
            btn.innerText = "Публикация... (подождите)";

            try {
                const response = await fetch('https://eightvnews.onrender.com/create-article', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        category: document.getElementById('post-category').value,
                        content: content,
                        author: author
                    })
                });

                if (response.ok) {
                    alert("Готово! Статья в сети.");
                    window.location.href = 'index.html';
                } else {
                    alert("Ошибка сервера. Попробуйте позже.");
                }
            } catch (err) {
                alert("Сервер Render просыпается. Подождите 30 секунд и нажмите еще раз.");
            } finally {
                btn.disabled = false;
                btn.innerText = "Опубликовать";
            }
        }
    </script>
</body>
</html>

