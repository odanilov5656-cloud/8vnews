<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Написать статью — Daily News</title>
    <link rel="stylesheet" href="style.css">
</head>
<body style="background: #f4f4f4; font-family: sans-serif;">
    <header style="background: #222; color: white; padding: 15px 0;">
        <div class="container" style="max-width: 800px; margin: 0 auto; padding: 0 20px;">
            <a href="index.html" style="color: white; text-decoration: none;">← На главную</a>
        </div>
    </header>

    <main class="container" style="max-width: 800px; margin: 30px auto; padding: 20px; background: white; border-radius: 10px;">
        <h2>Создание статьи</h2>
        <input type="text" id="post-title" placeholder="Заголовок" style="width: 100%; padding: 10px; margin-bottom: 10px;">
        <select id="post-category" style="width: 100%; padding: 10px; margin-bottom: 10px;">
            <option>Технологии</option>
            <option>Спорт</option>
            <option>Жизнь</option>
        </select>
        <textarea id="post-content" placeholder="Ваш текст..." style="width: 100%; height: 200px; padding: 10px; margin-bottom: 10px;"></textarea>
        <button onclick="publishPost()" id="publish-btn" style="width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer;">Опубликовать</button>
    </main>

    <script>
        async function publishPost() {
            const btn = document.getElementById('publish-btn');
            const author = localStorage.getItem('currentUser');
            const title = document.getElementById('post-title').value;
            const content = document.getElementById('post-content').value;

            if (!author) { alert("Войдите в аккаунт!"); return; }
            if (!title || !content) { alert("Заполните поля!"); return; }

            btn.disabled = true;
            btn.innerText = "Публикация (может занять до 1 мин)...";

            try {
                const response = await fetch('https://eightvnews.onrender.com/create-article', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        category: document.getElementById('post-category').value,
                        content: content,
                        author: author
                    })
                });

                if (response.ok) {
                    alert("Статья опубликована!");
                    window.location.href = 'index.html';
                } else {
                    alert("Ошибка сервера.");
                }
            } catch (error) {
                alert("Ошибка сети! Проверьте интернет или подождите, пока сервер проснется.");
            } finally {
                btn.disabled = false;
                btn.innerText = "Опубликовать";
            }
        }
    </script>
</body>
</html>

